<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title> <%= adminType %></title>

  <!-- Bootstrap CSS CDN -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
  <!-- Our Custom CSS -->
  <link rel="stylesheet" href="/stylesheets/style2.css">



  <!-- Font Awesome JS -->
  <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
</head>

<body onload="document.getElementById('acct').click()">
  <div class="wrapper">
    <!-- Sidebar  -->
    <nav id="sidebar">
      <div class="sidebar-header">
        <h3> PLVCS  </h3>
      </div>

      <ul class="list-unstyled components">


        <li>
          <a id="acct" href="" onclick="event.preventDefault();acctInfo();
            "> Account </a>
        </li>

        <li>
          <a href="#"> Dashboard </a>
        </li>
        <li>
          <a onclick="eventAct()" href="#"> Event/Activities</a>
        </li>
        <li>
          <a href="#"> Notification</a>
        </li>
        <li>
          <a onclick="getEvents('/event')" href="#"> Social Contract Record </a>
        </li>
        <li>
          <a href="#">History </a>
        </li>
        <li>
          <a href="#"> Logout</a>
        </li>
      </ul>


    </nav>

    <!-- Page Content  -->
    <div id="content">

      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">

          <button type="button" id="sidebarCollapse" class="btn btn-info">
            <i class="fas fa-align-left"></i>
            <span> </span>
          </button>

        </div>
      </nav>

      <div class="containter" id="mainC">

        <div class="container mx-auto">


          <h1 class="text-center"> Personal Information </h1>
          <br>
          <div class="row">
            <div class="col d-3">
              <p class="p-2 text-dark">
                Email: <%= currentAdmin.email%>
              </p>
              <br>
              <p class="p-2 text-dark">
                Surname : <%= currentAdmin.surname%>
              </p>
              <br>
              <p class="p-2 text-dark">
                First Name : <%= currentAdmin.firstName%>
              </p>
              <br>
              <p class="p-2 text-dark">
                Middle Name : <%= currentAdmin.middleName%>
              </p>
              <br>

            </div>

            <div class="col">
              <p class="p-2 text-dark">
                Username : <%= currentAdmin.username%>
              </p>
              <br>
              <p class="p-2 text-dark">
                DepartmentCode : <%=currentAdmin.departmentCode  %>
              </p>
              <br>
              <p class="p-2 text-dark">
                Admin Type : <%= currentAdmin.adminType  %>
              </p>
              <br>



            </div>

          </div>

        </div>









      </div>
      <br>

      <div id="scanC">
      </div>


    </div>
  </div>




  <!-- jQuery CDN - Slim version (=without AJAX) -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <!-- Popper.JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
  <!-- Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>


  <script src="/javascripts/html5-qrcode.min_.js"></script>


  <script type="text/javascript">
    $(document).ready(function () {
      $('#sidebarCollapse').on('click', function () {
        $('#sidebar').toggleClass('active');
      });
    });




    function change() {
      document.getElementById('mainC').innerHTML = account;
    }

    function stchange() {
      document.getElementById('mainC').innerHTML = StudentAcct;
    }

    function adch(user) {

      let users = [
        adminOic,
        adminAcctMaker,
        adminEAO
      ]


      document.getElementById('mainC').innerHTML = users[user]
    }

    function generatePassword() {
      var length = 8,
      charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",
      retVal = "";
      for (var i = 0, n = charset.length; i < length; ++i) {
        retVal += charset.charAt(Math.floor(Math.random() * n));
      }
      /*  return*/ document.getElementById('password').value = retVal;
    }



    eventc = `   <h1 class="text-center"> Create An Event</h1>

    <form class="w-75 form-group" method="post" action="/admin/create/event" enctype="multipart/form-data">

    <label for="eventname"> Event Name:</label>
    <input id="eventname" class="form-control" name="eventname" required>
    <br>
    <label for="eventhours">Event Number of Required Hours:</label>
    <input id="eventhours" type="number" name="eventhours" class="form-control" required>
    <br>
    <label for="eventhours">Event No of Students To Participate:</label>
    <input id="eventhours" type="number" name="eventnoofstudent" placeholder="leave it empty if unlimite number of student can apply" class="form-control" >

    <br>
    
    <label for="sdeventhours">Event Start Date:</label>
    <input id="sdeventhours" type="date" name="eventstartdate"  class="form-control" >

    <br>  
       <label for="sdjeventhours">Event End Date:</label>
    <input id="sdjeventhours" type="date" name="eventenddate"  class="form-control" >

    <br>  
    
    
    
    <label for="eventhours"> Venue:</label>
    <input id="eventhours" type="" name="venue" class="form-control" required>
    <br>
    <label for="eventhours"> Date and Time:</label>
    <input id="eventhours" type="" name="dateandtime" class="form-control" required>
    <br>
    <label for="eventhours"> Upload Scanned Image</label>
    <input id="eventhours" type="file" name="scannedimage" class="form-control" required>
    <br>


    <input type="submit" class="form-control bg-primary text-white text-center" value="Submit  Event">
    </form>

    `;


    activity = `   <h1 class="text-center"> Create An Activity</h1>

    <form class=" w-75 form-group" method="post" action="/admin/create/activity" enctype="multipart/form-data">

    <label for="eventname"> Activity Name:</label>
    <input id="eventname" class="form-control" name="activityname" required>
    <br>
    <label for="activityhours">Activity Number of Required Hours:</label>
    <input id="activityhours" type="number" name="activityhours" class="form-control" required>
    <br>
    <label for="eventhours">Activity No of Students To Participate:</label>
    <input id="eventhours" type="number" name="activitynoofstudent" class="form-control" required>
    <br>
    <label for="eventhours"> Venue:</label>
    <input id="eventhours" type="" name="venue" class="form-control" required>
    <br>
    <label for="eventhours"> Date and Time:</label>
    <input id="eventhours" type="" name="dateandtime" class="form-control" required>
    <br>
    <label for="ueventhours"> Upload Scanned Image</label>
    <input id="ueventhours" type="file" name="scannedimage" class="form-control" required>
    <br>


    <input type="submit" class="form-control bg-primary text-white text-center" value="Submit  Activity">
    </form>

    `


    createEventDash = `   <div class="row">
    <div class="col"><button class="btn btn-primary btn-md" onclick="ch('event')" > Create Event</button></div>

    <div class="col"><button class="btn btn-primary btn-md" onclick="ch('activity')" > Create Activity</button></div>
    </div>

    `;

    function eventAct () {
      document.getElementById('mainC').innerHTML = createEventDash
    }




    function ch(g) {
      if (g == 'event') {
        eventAct()
        document.getElementById('mainC').innerHTML = createEventDash +eventc;
      } else {
        document.getElementById('mainC').innerHTML = createEventDash+  activity
      }
    }


    function getEventInfo(a) {

      async function fetchText(k) {
        let ReportedString = " ";



        try {
          let response = await fetch(k);
          let data = await response.text();
          // alert(data)
          arr = JSON.parse(data)

          socialContract = `  <div  class="bg-primary mx-auto" style="height:500px;overflow:scroll">
          <br>
          <br>
          <div class="  mx-auto p-3" style="background-color:silver;width:97%;border:1px solid white">

          <p style="visibility:none"></p>

   
          <input onclick="modifyEvent('/event/${arr.id}')" style="border:1px solid white" type="button" value="Modify Event" class="bg-danger text-white">

          </li> 

          <nav class="d-flex flex-row justify-content-around " style="list-style-type:none">
          
          
          <li class=""> Event/Activity ID: </li>


          <li class=""> Event/Activity Name: ${arr.eventName} </li>
          </nav>

          <p class="text-center"> List of Participants</p>

          <nav class="d-flex justify-content-between"  style="list-style-type:none">
          <li>
          Semester
          <select class="select bg-white">
          <option class=" ">2</option>
          <option class=" ">2</option>
          </select>

          <span>School Year:</span>
          <input class="d-inline bg-white" >
          </li>

       
          <li onclick="markAttendance('${arr.id}')"> <input   style="border:1px solid white" type="button" value="Action" class="bg-primary text-white"> </li>


          </nav>
          <br>
          <br>

          <table class="table table-striped table-responsive" id="contracttable">
          <tr class="bg-primary text-white">
          <td>No</td>
          <td>Student ID</td>
          <td>Student Name</td>
          <td>Course</td>
          <td>Yr & Section</td>
          <td> Event Required Hours </td>
          <td>Date Start</td>
          <td> Date End</td>
          <td> Hours Rendered</td>
          <td>  Modify Number of Rendered Hours </td>
          </tr>

          `



          let i = 1;
          let n = 0
          //for (student of arr.studentParticipatingAndHoursRendered/*arr.studentParticipating*/) {
          //  ReportedString += `<tr>     
       /*     <td> ${i++}</td>    
            <td> ${student.studentId.studentNo}</td>
            <td> ${student.studentId.username}</td> 
            <td> ${student.studentId.course}</td> 
            <td>          </td>
            <td>     ${arr.eventHours}     </td>
            <td> ${arr.eventStartDate}   </td>
            <td> ${arr.eventEndDate}   </td>   */
       //     <td> ${student./*studentParticipatingAndHoursRendered[n].*/renderedHours}   </td>
    /*    <td>  <input id="${student.studentId._id}" > <button onclick="assignRenderedHours('/event/inputrenderedhours/${arr._id}/${student.studentId. _id}/','${arr._id}','${student.studentId._id}')"> save  </button> </td>
            </tr>`;
          } */
          
          

          document.getElementById('mainC').innerHTML = socialContract + /*ReportedString + */restSocial


        }
        catch (err) {
          alert("Please try again " + err)
        }
      }

      fetchText(a)


    }


    function getEvents(a) {

      async function fetchText(k) {
        //    let ReporteEvents = `<div class="row" >` ;
        let ReporteEvents = `
         <div  class=" col  shadow">
        
        <table class="table table-bordered table-striped">
        <tr>
        <th> Name of Event </th>
        <th> Event Required Hours </th>
        <th> Event Start Date </th>
        <th>  Event End Date </th>
        <th> Event No of students allowed to participate </th>
        <th> Event Venue </th>
        <th> Event Date and Time </th>
        <th> Number Of Student Who are willing to Participate in This Event </th>
        <th> Manage </th>

        </tr>

        `;
        let endEvent = `</table>`
        try {

          let response = await fetch(k);
          let data = await response.text()
          let arr = JSON.parse(data)

          for (event of arr) {
            ReporteEvents += `<!-- <div onclick="getEventInfo('/event/${event.id}')" class=" col   w-50 shadow"> -->
            <tr>

            <td>  ${event.eventName} </td>

            <td>    ${event.eventHours} </td>
            <td> </td>
            <td> </td>
           
           <td> ${event.eventNoOfStudent} </td>
           <td> ${event.eventVenue} </td>
           <td> ${event.dateAndTime} </td>
           <td> ${event.listofStudentWishingToParticipate} </td>
           
           <td> <button onclick="getEventInfo('/event/${event.id}')" class="btn btn-primary"> Manage </button> </td>
            </tr>`;
          }




          document.getElementById('mainC').innerHTML = ReporteEvents + endEvent;
        }

        catch (err) {
          alert("Please try again " + err)
        }
      }

      fetchText(a)


    }



    restSocial = `</table>



    </div>
    <br>
    <br>
    </div>
    `




    function markAttendance(eventId) {
      scanUi = `<br> <br>  <div class="row mx-auto w-75">
      <div class="col">
      <p class="d-none" id="evid">${eventId}  </p>
      <div style="width:500px;" id="reader"></div>
      </div>
      <!--  <div class="col" style="padding:30px;">
      <h4>SCAN RESULT</h4>
      <div id="result">
      Result Here
      </div> -->
      </div>
      </div>
      `

      document.getElementById('mainC').innerHTML += scanUi;

      async function  onScanSuccess(qrCodeMessage) {

        let eventNeedsNewParticipant = document.getElementById('evid');

        eventidentifier = eventNeedsNewParticipant.innerHTML +"/";
        let studentId = qrCodeMessage;

        let urlz = "/event/markAttendance/" +eventidentifier+qrCodeMessage
        // alert(eventidentifier)
        let updatedEv = await attend(urlz.trim())
        let ei = eventidentifier.replace('/', '').trim()

        getEventInfo(`/event/${ei}`)
        alert(updatedEv)




      }

      function onScanError(errorMessage) {
        //handle scan error
        /* setTimeOut(()=>{alert(errorMessage + "Pls Try again")},10000)*/
        alert("this qr is not registered")

      }
      var html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", {
          fps: 10, qrbox: 250
        });
      html5QrcodeScanner.render(onScanSuccess, onScanError);



    }



    async function attend(a) {
      let response = await fetch(a);
      let data = await response.text();
      return data
    }



    accountInfo = `
    <div class="container mx-auto">


    <h1 class="text-center"> Personal Information </h1>
    <br>
    <div class="row">
    <div class="col d-3">
    <p class="p-2 text-dark"> Email: <%= currentAdmin.email%> </p>
    <br>
    <p class="p-2 text-dark">Surname : <%= currentAdmin.surname%> </p>
    <br>
    <p class="p-2 text-dark"> First Name : <%= currentAdmin.firstName%> </p>
    <br>
    <p class="p-2 text-dark">Middle Name : <%= currentAdmin.middleName%> </p>
    <br>

    </div>

    <div class="col">
    <p class="p-2 text-dark">Username : <%= currentAdmin.username%> </p>
    <br>
    <p class="p-2 text-dark">DepartmentCode : <%=currentAdmin.departmentCode  %> </p>
    <br>
    <p class="p-2 text-dark">Admin Type : <%= currentAdmin.adminType  %> </p>
    <br>



    </div>

    </div>

    </div>`




    function acctInfo() {

      document.getElementById("mainC").innerHTML = accountInfo;


    }
    
    
   async function modifyEvent(a) {
      
      try {
          let response = await fetch(a);
          let data = await response.text();
          // alert(data)
          arr = JSON.parse(data) 
          
          
         eventUiToBeModified = `   <h1 class="text-center"> Modify  The Event</h1>

    <form class="w-75 form-group" method="post" action="/event/modify/${arr._id}" enctype="multipart/form-data">

    <label for="eventname"> Event Name:</label>
    <input value="${arr.eventName}" id="eventname" class="form-control" name="eventname" required>
    <br>
    <label for="eventhours">Event Number of Required Hours:</label>
    <input id="eventhours" value="${arr.eventHours}" type="number" name="eventhours" class="form-control" required>
    <br>
    <label for="eventhours">Event No of Students To Participate:</label>
    <input value="${arr.eventNoOfStudent}" id="eventhours" type="number" name="eventnoofstudent" placeholder="leave it empty if unlimite number of student can apply" class="form-control" >

    <br>
    <label for="eventhours"> Venue:</label>
    <input id="eventhours" value="${arr.eventVenue}" type="" name="venue" class="form-control" required>
    <br>
    <label for="eventhours"> Date and Time:</label>
    <input value="${arr.dateAndTime}" id="eventhours" type="" name="dateandtime" class="form-control" required>
    <br>
    <label for="eventhours"> Upload Scanned Image</label>
    <input id="eventhours" type="file" name="scannedimage" class="form-control" required>
    <br>


    <input type="submit" class="form-control bg-primary text-white text-center" value="Submit  Event">
    </form>

    `; 
          
          
       document.getElementById("mainC").innerHTML = eventUiToBeModified   
          
        
       // alert(JSON.stringify(arr))
        
      }
          
          
          catch (err) {
            alert(err)
          }
     
     

      
      

      
    }
    
    
 async   function assignRenderedHours(a,b,c) {
      let numberOfHours = document.getElementById(c).value
      let response = await fetch(a+numberOfHours);
      let data = await response.text();
      getEventInfo(`/event/${b}`)
      alert(data)
   
  //    return data;
      
    }
    
    


  </script>
</body>

</html>